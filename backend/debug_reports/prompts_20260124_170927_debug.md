# IRIS Debug Report

**File:** `prompts.py`  
**Language:** `python`  
**Execution Path:** ðŸ”§ Tool-Calling (Single-Stage with Dynamic Source Reading)  

---

## Source Code Overview

### Stage 1: Original Source Code

*Source code not available in snapshots*

### Signature Graph Snapshot

**Entities:** 9

```json
{
  "entities": [
    {
      "id": "entity_0",
      "name": "json",
      "type": "import",
      "signature": "import json",
      "line_range": [
        17,
        17
      ],
      "depth": 0,
      "scope": "module",
      "parent_id": null,
      "children_ids": [],
      "calls": [],
      "leading_comment": null,
      "inline_comment": null,
      "trailing_comment": null,
      "docstring": null
    },
    {
      "id": "entity_1",
      "name": "from typing import Any, Dict",
      "type": "import",
      "signature": "from typing import Any, Dict",
      "line_range": [
        18,
        18
      ],
      "depth": 0,
      "scope": "module",
      "parent_id": null,
      "children_ids": [],
      "calls": [],
      "leading_comment": null,
      "inline_comment": null,
      "trailing_comment": null,
      "docstring": null
    },
    {
      "id": "entity_2",
      "name": "build_tool_calling_prompt",
      "type": "function",
      "signature": "def build_tool_calling_prompt(\n    filename: str,\n    language: str,\n    shallow_ast: Dict[str, Any],\n) -> str",
      "line_range": [
        378,
        398
      ],
      "depth": 0,
      "scope": "module",
      "parent_id": null,
      "children_ids": [],
      "calls": [],
      "leading_comment": "# =============================================================================\n# TOOL-CALLING: SINGLE-STAGE ANALYSIS WITH SOURCE CODE ACCESS\n# =============================================================================",
      "inline_comment": null,
      "trailing_comment": null,
      "docstring": "\"\"\"Build prompt for tool-calling single-stage analysis.\n\n    Includes analysis strategy to guide top-down comprehension, including\n    nested container structure support when present in the Shallow AST.\n    \"\"\""
    },
    {
      "id": "entity_3",
      "name": "build_identification_prompt",
      "type": "function",
  ...(truncated for readability)
```

---

## LLM Processing Metrics

### ðŸ”§ Tool-Calling Execution

Single-stage analysis with dynamic source reading: LLM analyzes shallow AST and calls `refer_to_source_code()` tool when needed.

#### Summary

| Metric | Value |
|--------|-------|
| Total Input Tokens | 3,905 |
| Total Output Tokens | 791 |
| Total Tokens | 4,696 |
| Total Time | 19.06s |
| Stages | 1 |

#### Stage Details

**Tool Calling Analysis**

| Metric | Value |
|--------|-------|
| Input Tokens | 3,905 |
| Output Tokens | 791 |
| Total Tokens | 4,696 |
| Time | 19.06s |

**Throughput:**

- Tokens/Second: 246.4 tok/s
- Input: 3,905 tok | Output: 791 tok | Total: 4,696 tok

<details>
<summary><strong>ðŸ“„ Full LLM Response</strong> (click to expand)</summary>

```json
{
  "file_intent": "Utility module for generating prompts related to code analysis and identification, ensuring clarity in understanding source code structures and responsibilities.",
  "initial_hypothesis": "The file contains functions that build various prompts for analyzing code, focusing on identification and analysis stages.",
  "entity_count_validation": {
    "total_entities": 9,
    "responsibilities_count": 6,
    "required_range": "6-10",
    "passes_anti_collapse_rule": true
  },
  "verification_processes": [],
  "responsibilities": [
    {
      "id": "tool-calling-prompt",
      "label": "Tool Calling Prompt Builder",
      "description": "Constructs prompts for tool-calling analysis, guiding comprehension of code structure.",
      "elements": {
        "functions": [
          "build_tool_calling_prompt"
        ],
        "state": [],
        "imports": [
          "json",
          "Any",
          "Dict"
        ],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          378,
          398
        ]
      ]
    },
    {
      "id": "identification-prompt",
      "label": "Identification Prompt Builder",
      "description": "Creates prompts to identify unclear parts of the code that require further analysis.",
      "elements": {
        "functions": [
          "build_identification_prompt"
        ],
        "state": [],
        "imports": [],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          511,
          545
        ]
      ]
    },
    {
      "id": "analysis-prompt",
      "label": "Analysis Prompt Builder",
      "description": "Generates prompts for detailed analysis of code, including intent and responsibilities.",
      "elements": {
        "functions": [
          "build_analysis_prompt"
        ],
        "state": [],
        "imports": [],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          668,
          704
        ]
      ]
    },
    {
      "id": "fast-path-prompt",
      "label": "Fast Path Prompt Builder",
      "description": "Builds prompts for quick analysis of small files using full source code.",
      "elements": {
        "functions": [
          "build_fast_path_prompt"
        ],
        "state": [],
        "imports": [],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          788,
          809
        ]
      ]
    },
    {
      "id": "raw-source-prompt",
      "label": "Raw Source Prompt Builder",
      "description": "Creates prompts using only raw source code for performance testing.",
      "elements": {
        "functions": [
          "build_raw_source_prompt"
        ],
        "state": [],
        "imports": [],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          812,
          838
        ]
      ]
    },
    {
      "id": "utility-functions",
      "label": "Utility Functions for Detection Patterns",
      "description": "Provides additional utilities for detecting hub objects and generating responsibility templates.",
      "elements": {
        "functions": [
          "get_hub_detection_patterns",
          "get_responsibility_templates"
        ],
        "state": [],
        "imports": [],
        "types": [],
        "constants": []
      },
      "ranges": [
        [
          846,
          944
        ]
      ]
    }
  ],
  "metadata": {
    "logical_depth": "Shallow",
    "notes": "Functions are well-defined with clear purposes; no ambiguous entities were found."
  }
}
```

</details>

---

*Report generated for IRIS AST transformation analysis*